!function(e,t){"use strict";if("undefined"!=typeof module&&void 0!==module.exports){var i=require("jquery");module.exports=t(i)}else"function"==typeof define&&define.amd?define(["jquery"],function(e){return t(e)}):e.Validator=t(e.jQuery||e.Zepto||e.$)}(this,function(e){"use strict";function t(e){return e&&"function"==typeof e.promise}function i(t,i,n){return n?e.each(t,e.proxy(i,n)):e.each(t,i)}function n(e){var t=e[0].tagName.toUpperCase();return"INPUT"===t?e.attr("type").toUpperCase():t}var r={listen:function(e,t){var n={};"string"==typeof e?n[e]=t:(n=e,e=null),i(n,function(e,t){var i=this._events[e]||[];i.push(t),this._events[e]=i},this)},trigger:function(e){var t,i,n,r=this._events[e]||[],s=Array.prototype.slice.call(arguments,1);for(t=0;i=r[t];t++)"string"==typeof i&&(i=this[i]),n=i.apply(this,s);return n}},s=function(t){this.$form=e(t.formSelector),this.addField(t.fields),this.listen(t.events),this.$form.attr("novalidate","novalidate"),this.$form.on("submit",e.proxy(this.fireSubmit,this)),this.autoSubmit="autoSubmit"in t?t.autoSubmit:!0};e.extend(s.prototype,r,{_events:[],fields:{},autoSubmit:!0,addField:function(e,t){var i={};"string"==typeof e?i[e]=t:i=e;for(e in i)i[e].V=this,i[e].$form=this.$form,this.fields[e]=new o(e,i[e])},fireSubmit:function(){return this.fireValidate("",!0),!1},fireValidate:function(t,i){var n=this.fields,r=[],s=this;if(t&&t in n)return n[t].validate(i);for(t in n)r.concat(n[t].validate(i));e.when.apply(null,r).then(function(){var e=0;for(t in n)e+=1*!n[t].isValid;0===e&&(s.trigger("beforeSubmit"),s.autoSubmit&&s.$form[0].submit())},function(){})},extend:function(t){e.extend(this,t)}}),e.extend(s.prototype,{delField:function(e){var t,i=this.fields;for(e=e.split(" "),t=0;t<e.length;t++)delete i[e[t]]},disableField:function(e){this.toggleDisable(e,!0)},enableField:function(e){this.toggleDisable(e,!1)},toggleDisable:function(e,t){var i,n,r=this.fields;for(e=e.split(" "),i=0;void 0!==(n=e[i]);i++)n in r&&(r[n].isDisable=t)},getFormData:function(e){var t=this.fields,n={};return e&&e in t?t[e].$node.val():(i(t,function(e,t){n[e]=t.$node.val()},this),n)},isValid:function(e){return this.fields[e].isValid}});var o=function(t,r){var s=r.el?e(r.el,r.$form):e("[name="+t+"]",r.$form),o=n(s);"TEXT PASSWORD TEXTAREA EMAIL NUMBER".indexOf(o)>-1?(s.on("blur",{context:this},function(e){var t=e.data.context;t.V.trigger("blur"+t.fieldName,t),t.V.trigger("blur",t),t.validate()}),s.on("focus",{context:this},function(e){var t=e.data.context;t.V.trigger("focus"+t.fieldName,t),t.V.trigger("focus",t)})):"RADIO CHECKBOX".indexOf(o)>-1?s.on("click tap",{context:this},function(e){var t=e.data.context;t.validate()}):"SELECT".indexOf(o)>-1&&s.on("change",{context:this},function(e){var t=e.data.context;t.validate()}),i("checkEmpty message messageTo isDisable required serverCallback V $form".split(" "),function(e,t){t in r&&(this[t]=r[t])},this),this.$node=s,this.elType=o,this.fieldName=t,this.parseRule(r.rules)};return e.extend(o.prototype,r,{$node:null,elType:"",rules:[],fieldName:"",checkEmpty:!1,message:"",messageTo:"",isValid:!0,isDisable:!1,required:!0,_events:[],validate:function(n){var r=this,s=[],o=this.$node.val();return this.isDisable||""===o&&(!this.required||!n&&!this.checkEmpty)?[]:(this.isValid=!0,i(this.rules,function(i,n){var a,u=n.handler;return a="string"==typeof u?this[u](n.option,o):u.call(this,o),a===!1?(this.validateError(i),!1):void(t(a)&&(s.push(a),e.when(a).fail(function(){this.validateError(i)}).done(function(e){r.serverCallback(e)||this.validateError(i)})))},this),e.when.apply(null,s).done(function(){r.isValid===!0&&r.validateSuccess()}),s)},validateError:function(e){var t={name:this.fieldName,$node:this.$node,message:this.message,messageTo:this.messageTo};"string"!=typeof t.message&&(t.message=t.message[e]),this.isValid=!1,this.V.trigger("error:"+this.fieldName,t),this.V.trigger("error",t)},validateSuccess:function(){this.isValid=!0,this.V.trigger("success:"+this.fieldName),this.V.trigger("success",this)},serverCallback:function(){return!0},parseRule:function(t){return this.rules=[],void 0===t?void this.rules.push(this.required?"CHECKBOX RADIO".indexOf(this.elType)>-1?{handler:"isChecked"}:{handler:"isset"}:{handler:"ignore"}):(e.isArray(t)||(t=[t]),void i(t,function(t,i){var n=e.type(i),r={};"regexp"===n?(r.handler="regexp",r.option=i):"function"===n?(r.handler=i,r.option=""):"string"===n?0===i.indexOf("confirm")?(r.handler="confirm",r.option=e(i.split(" ")[1],this.$form)):0===i.indexOf("server")?(r.handler="server",r.option=i.split(" ")[1]):(r.handler="equal",r.option=i):(r.handler="equal",r.option=i),this.rules.push(r)},this))}}),e.extend(o.prototype,{regexp:function(e,t){return e.test(t)},equal:function(e,t){return e===t},confirm:function(e,t){return e.val()===t},isset:function(e,t){return""!==t},isChecked:function(){var e=!1;return this.$node.each(function(){this.checked&&(e=!0)}),e},ignore:function(e,t){return!0},server:function(t,i){return e.ajax({})}}),function(e){return new s(e)}});