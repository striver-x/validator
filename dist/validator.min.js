!function(e,t){"use strict";if("undefined"!=typeof module&&void 0!==module.exports){var i=require("jquery");module.exports=t(i)}else"function"==typeof define&&define.amd?define(["jquery"],function(e){return t(e)}):e.Validator=t(e.jQuery||e.Zepto||e.$)}(this,function(e){"use strict";function t(e){return"TEXT PASSWORD TEXTAREA EMAIL NUMBER".indexOf(e)>-1}function i(e,t){e.V.trigger(t+":"+e.fieldName,e),e.V.trigger(t,e)}function n(e){return e&&"function"==typeof e.promise}function r(t,i,n){return n?e.each(t,e.proxy(i,n)):e.each(t,i)}function s(e){var t=e[0].tagName.toUpperCase();return"INPUT"===t?e.attr("type").toUpperCase():t}var o={listen:function(e,t){var i={};"string"==typeof e?i[e]=t:(i=e,e=null),r(i,function(e,t){var i=this._events[e]||[];i.push(t),this._events[e]=i},this)},trigger:function(e){var t,i,n,r=this._events[e]||[],s=Array.prototype.slice.call(arguments,1);for(t=0;i=r[t];t++)"string"==typeof i&&(i=this[i]),n=i.apply(this,s);return n}},a=function(t){this.$form=e(t.formSelector),this.addField(t.fields),this.listen(t.events),this.$form.attr("novalidate","novalidate"),this.$form.on("submit",e.proxy(this.fireSubmit,this)),this.autoSubmit="autoSubmit"in t?t.autoSubmit:!0};e.extend(a.prototype,o,{_events:[],fields:{},autoSubmit:!0,addField:function(e,t){var i={};"string"==typeof e?i[e]=t:i=e;for(e in i)i[e].V=this,i[e].$form=this.$form,this.fields[e]=new l(e,i[e])},fireSubmit:function(){return this.fireValidate("",!0),!1},fireValidate:function(t,i){var n=this.fields,r=[],s=this;if(t&&t in n)return n[t].validate(i);for(t in n)r.concat(n[t].validate(i));e.when.apply(null,r).then(function(){var e=0;for(t in n)e+=1*!n[t].isValid;0===e&&(s.trigger("beforeSubmit"),s.autoSubmit&&s.$form[0].submit())},function(){})},extend:function(t){e.extend(this,t)}}),e.extend(a.prototype,{delField:function(e){var t,i=this.fields;for(e=e.split(" "),t=0;t<e.length;t++)delete i[e[t]]},disableField:function(e){this.toggleDisable(e,!0)},enableField:function(e){this.toggleDisable(e,!1)},toggleDisable:function(e,t){var i,n,r=this.fields;for(e=e.split(" "),i=0;void 0!==(n=e[i]);i++)n in r&&(r[n].isDisable=t)},getFormData:function(e){var t=this.fields,i={};return e&&e in t?t[e].$node.val():(r(t,function(e,t){i[e]=t.$node.val()},this),i)},isValid:function(e){return this.fields[e].isValid}});var u={TEXT:"blur",PASSWORD:"blur",TEXTAREA:"blur",EMAIL:"blur",NUMBER:"blur",RADIO:"click",CHECKBOX:"click",SELECT:"change"},l=function(n,o){var a=o.el?e(o.el,o.$form):e("[name="+n+"]",o.$form),l=s(a),f=u[l];a.on(f,{context:this,eventType:f},function(e){var t=e.data.context;i(t,e.data.eventType),t.validate()}),t(l)&&a.on("focus",{context:this,eventType:"focus"},function(e){i(e.data.context,e.data.eventType)}),r("checkEmpty message messageTo isDisable required serverCallback V $form".split(" "),function(e,t){t in o&&(this[t]=o[t])},this),this.$node=a,this.elType=l,this.fieldName=n,this.parseRule(o.rules)};return e.extend(l.prototype,o,{$node:null,elType:"",rules:[],fieldName:"",checkEmpty:!1,message:"",messageTo:"",isValid:!0,isDisable:!1,required:!0,_events:[],validate:function(t){var i=this,s=[],o=this.$node.val();return this.isDisable||""===o&&(!this.required||!t&&!this.checkEmpty)?[]:(this.isValid=!0,r(this.rules,function(t,r){var a,u=r.handler;return a="string"==typeof u?this[u](r.option,o):u.call(this,o),a===!1?(this.validateError(t),!1):void(n(a)&&(s.push(a),e.when(a).fail(function(){this.validateError(t)}).done(function(e){i.serverCallback(e)||this.validateError(t)})))},this),e.when.apply(null,s).done(function(){i.isValid===!0&&i.validateSuccess()}),s)},validateError:function(e){var t={name:this.fieldName,$node:this.$node,message:this.message,messageTo:this.messageTo};"string"!=typeof t.message&&(t.message=t.message[e]),this.isValid=!1,this.V.trigger("error:"+this.fieldName,t),this.V.trigger("error",t)},validateSuccess:function(){this.isValid=!0,this.V.trigger("success:"+this.fieldName),this.V.trigger("success",this)},serverCallback:function(){return!0},parseRule:function(t){return this.rules=[],void 0===t?void this.rules.push(this.required?"CHECKBOX RADIO".indexOf(this.elType)>-1?{handler:"isChecked"}:{handler:"isset"}:{handler:"ignore"}):(e.isArray(t)||(t=[t]),void r(t,function(t,i){var n=e.type(i),r={};"regexp"===n?(r.handler="regexp",r.option=i):"function"===n?(r.handler=i,r.option=""):"string"===n?0===i.indexOf("confirm")?(r.handler="confirm",r.option=e(i.split(" ")[1],this.$form)):0===i.indexOf("server")?(r.handler="server",r.option=i.split(" ")[1]):(r.handler="equal",r.option=i):(r.handler="equal",r.option=i),this.rules.push(r)},this))}}),e.extend(l.prototype,{regexp:function(e,t){return e.test(t)},equal:function(e,t){return e===t},confirm:function(e,t){return e.val()===t},isset:function(e,t){return""!==t},isChecked:function(){var e=!1;return this.$node.each(function(){this.checked&&(e=!0)}),e},ignore:function(e,t){return!0},server:function(t,i){return e.ajax({})}}),function(e){return new a(e)}});